
<html>
  <head>
    <%= javascript_include_tag "prototype" %>
    <%= javascript_include_tag 'jquery' %>
    <%= stylesheet_link_tag 'extra_buttons' %>
    <%= javascript_include_tag 'jquery_data_table.js' %>
    <%= stylesheet_link_tag 'jquery.dataTables' %>
    <%=javascript_include_tag "jquery.table2CSV.min" %>
    <script type="text/css" charset="utf8" src="/stylesheets/keyboard.css"></script>


  <script>
  var keyboard
  var search

  function showDrugs(){
    html = "<table width='98%' align= 'center'><th colspan=2 >Supervision Verified Stocks</th>";
        html += '<tr class="header"><td width="50%"><b>Drug</b></td><td width="50%"><b>Amount In Tins (Verified)</b></td></tr></table>'
        html += "<form id='stock' name='stock' action='stock_report_edit' method='post'><table width='98%' align= 'center'>"
        html +="<input type='hidden' name='delivery_date' value='<%= @delivery_date %>'>";
    <%  @drugs.each {|drug| %>
        html += '<tr><td width="50%">' + '<%= drug[0] %>' + '</td><td class="newIunputs">'
        html += "<input name='obs[" + '<%= drug[1] %>' + "]' type='text' id='write' onclick='showMe(this)' class='inputs'/>"
        html += '</td></tr>';
    <%  } %>
    html += '</table></form>';
    document.getElementById('inputFrame'+tstCurrentPage).innerHTML = '<div id="summary">' + html + '</div>';
    document.getElementById('nextButton').setAttribute("onmousedown", "submitMe();")
  }

  function submitMe(){
    drug_form = document.getElementById('stock')
    drug_form.submit()
  }

  function showMe(td){
    search = td
    keyboard = document.getElementById('keyboard');
    
    if(keyboard.style.display == 'none' || keyboard.style.display == ""){
      keyboard.style.display = "inline";
    }
    keyboard.setAttribute("tt_pageStyleClass", "Numeric NumbersWithUnknownAndDecimal");
    //else
    //{
     // keyboard.style.display = "none";
    //}
    document.body.appendChild(keyboard);
    showNumericKeypad()
  }

  function getCharButtonSetIDs(character,id){
    return '<button onMouseDown="pressed(\''+character+'\');" class="keyboardButton" id="'+id+'">' +"<span style='width:32px'>"+character+"</span>"+ "</button>";
  }
  function getButtonStrings(id,string){
    return "<button \
                            onMouseDown='pressed(this.id);' \
                            class='keyboardButton' \
                            id='"+id+"'>"+
      string +
      "</button>";
  }

  function getButtons1(chars){
    var buttonLine = "";
    for(var i=0; i<chars.length; i++){
      character = chars.substring(i,i+1)
      buttonLine += getCharButtonSetIDs(character,character)
    }
    return buttonLine;
  }

  function showAlphaKeypad(){
    //document.getElementById("keypad").style.height = "280";
    keyboard.innerHTML= getButtons("0123456789") + "</br>"
    keyboard.innerHTML+= getButtons("QWERTYUIOP") + "</br>"
    keyboard.innerHTML+= getButtons("ASDFGHJKL:") + "</br>"
    keyboard.innerHTML+= getButtons("ZXCVBNM,.?")
    keyboard.innerHTML+= getButtonString('backspace','<span>Bksp</span>')
    keyboard.innerHTML+= getButtonString('Space','<span>Space</span>')
    keyboard.innerHTML+= getButtonString('clear','<span>Clear</span>')
  }

  function showNumericKeypad(){
    //document.getElementById("keypad").style.height = "145";
    keyboard.innerHTML = getButtons1("123")
    keyboard.innerHTML+= getButtons1("456")
    keyboard.innerHTML+= getButtons1("7890")
   // keyboard.innerHTML+= getButtonString('space','<span>Space</span>')
    keyboard.innerHTML+= getButtonStrings('clear','<span>Clear</span>')
    keyboard.innerHTML+= getButtonStrings('backspace','<span>Bksp</span>')
    keyboard.innerHTML+= getButtonStrings('enter','<span>Enter</span>')
   // keyboard.innerHTML+= getButtonStrings('dash','<span>-</span>')
   // keyboard.innerHTML+= getButtonString('slash','<span>/</span>')
  }

  function pressed(pressedChar){
    switch (pressedChar) {
      case 'backspace':
        search.value = search.value.substring(0,search.value.length-1);
        //search_box.fnFilter(search.value)
        return;
      case 'Space':
        search.value+= " "
        //search_box.fnFilter(search.value)
        return
      case 'clear':
        search.value = ""
        //search_box.fnFilter(search.value)
        return
      case 'num':
        showNumericKeypad();
        return
      case 'slash':
        search.value+= "/"
        //search_box.fnFilter(search.value)
        return
      case 'dash':
        search.value+= "-"
        //search_box.fnFilter(search.value)
        return
      case 'abc':
        showAlphaKeypad();
        return
      case 'enter':
        keyboard.style.display = "none";
        return
    }
    search.value+= pressedChar
    //search_box.fnFilter(search.value)
  }
  
  //xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    </script>
    <style>
      #keyboard {
        position: absolute;
        background-color: black;
        width: 253px;
        height: 45%;
        left: 20%;
        top: 12%;
        z-index: 500;
        opacity: 0.98;
        align: center;
        display:none;
      }
      .inputs {
        height: 37px;
        font-size:33px;
      }
      .scrollTable {
        height: 400px ! important;
        overflow:scroll ! important;
      }
      #stock {
        height: 554px ! important;
        overflow:scroll ! important;
      }
      #summary {
        padding: 0px;
        font-size:1.2em;
        margin-left: 60px;
        height: 70px;
        max-height: 70px;

      }

      #backspace, #clear {
        position: static ! important;
      }
      th, .header {
        text-align: center;
        vertical-align: middle;
        background-color: grey;
        color: white;
        height: 10%;
        border-radius: 10px 10px 10px 10px;
      }
      .newIunputs {
        text-align: center;
        width: 45%;
      }
      #backspace{
        position:absolute;
        left:100px;
        bottom:2px;
      }

      #Space{
        position:absolute;
        left:220px;
        bottom:2px;
        width:200px;
      }

      #clear{
        position:absolute;
        left:470px;
        bottom:2px;
      }
      #num{
        position:absolute;
        left:470px;
        bottom:2px;
        width:200px;
      }
      #keypad{
        background-color: #FFFFFF;
        border: 2px solid #9999FF;
        border-radius: 15px 15px 15px 15px;
        display: none;
        height: 304px;
        padding: 5px;
        position: absolute;
        right: 13px;
        top: 194px;
        width: 672px;
      }
    </style>
  <div id="container">
    <form>
      <%= text_field_tag :showSummary, nil,
        {
        :tt_onLoad => "showDrugs();$('clearButton').style.display = 'none';  ",
        :tt_onUnLoad => " $('clearButton').style.display = 'inline';",
        :optional => "true",
        :id => "input",
        :tt_pageStyleClass => "NoKeyboard"
      } %>
    </form>
  </div>
</html>
